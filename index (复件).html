<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Galaxys2 kernel repack by xiaolu</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Galaxys2 kernel repack</h1>
          <h2>unpack s2&amp;note kernel and rebuild</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/xiaolu/galaxys2_kernel_repack/zipball/i9100-ics" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/xiaolu/galaxys2_kernel_repack/zipball/i9100-ics" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/xiaolu/galaxys2_kernel_repack" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <p><h3>= Galaxy S2 Kernel Packing/Repacking Tools =</h3></p>
          
(中文版说明在下边)<br>
Please edit repack.sh,you should point where your cross-compiler is:
<pre><code>COMPILER=/home/xiaolu/bin/android-toolchain-eabi/bin/arm-eabi
COMPILER_LIB=/home/xiaolu/bin/android-toolchain-eabi/lib/gcc/arm-eabi/4.5.4</pre></code>
Unpack zImage,Usage:
<pre><code>./unpack.sh zImagesy267 sy267</pre></code></p>
Repack zImage,Usage:
<pre><code>./repack.sh zImagesy267 initramfs.cpio new_zImage
or
./repack.sh zImagesy267 initramfs_dir new_zImage</pre></code>
Padding sufile to new_zImage offset=7000000,Example:
<pre><code>./repack.sh zImagesm189 sm189.cpio new_zImage su</pre></code>
post-int.sh(init.rc services):
<pre><code>dd if=/dev/block/mmcblk0p5 of=/system/bin/su skip=7000000 seek=0 bs=1 count=26336
dd if=/dev/block/mmcblk0p5 of=/system/app/Superuser.apk skip=7026336 seek=0 bs=1 count=196640
</code></pre>
Use payload(tar.xz) In the end of the new_zImage:
<pre><code>./repack.sh zImage initramfs.cpio new_zImage payload</pre></code>
payload in resources directory,Example of use(recovery.sh):
<pre><code>cd /
eval $(read_boot_headers /dev/block/mmcblk0p5)
load_offset=$recovery_offset
load_len=$recovery_len
dd bs=512 if=/dev/block/mmcblk0p5 skip=$load_offset count=$load_len | xzcat | tar x
</code></pre>
Custom zImage compression format:
<pre><code>./repack.sh zImagesy267 initramfs.cpio new_zImage gzip
or
./repack.sh zImagesy267 initramfs.cpio new_zImage payload gzip</pre></code>
中文版：
修改repack.sh开头的编译器路径和库文件路径，改为你自己的：
<pre><code>COMPILER=/home/xiaolu/bin/android-toolchain-eabi/bin/arm-eabi
COMPILER_LIB=/home/xiaolu/bin/android-toolchain-eabi/lib/gcc/arm-eabi/4.5.4</pre></code>
解包zImage，例如：
<pre><code>./unpack.sh zImagesy267 sy267</pre></code>
重新打包编译zImage：<br>
./repack.sh 原始zImage initramfs(目录或者cpio文件) 新zImage名<br>
例如：
<pre><code>./repack.sh zImagesy267 initramfs.cpio new_zImage
or
./repack.sh zImagesy267 initramfs_dir new_zImage</pre></code>
对于超出大小的initramfs，可以使用下边两种办法来打包：<br>
1.把2进制的su文件和Superuser.apk文件放在新zImage的7000000字节偏移处，命令：
<pre><code>./repack.sh zImagesm189 sm189.cpio new_zImage su</pre></code>
如何在启动的时候调用su和Superuser.apk，请在root脚本里添加如下:
<pre><code>dd if=/dev/block/mmcblk0p5 of=/system/bin/su skip=7000000 seek=0 bs=1 count=26336
dd if=/dev/block/mmcblk0p5 of=/system/app/Superuser.apk skip=7026336 seek=0 bs=1 count=196640</pre></code>
2.把一些大文件打包成tar.xz放在zImage末尾，启动需要用到的时候读取压缩包偏移量，用DD复制出来解压到rootfs相应位置。
<pre><code>./repack.sh zImagezclpn initramfs_zclpn new_zImage payload</pre></code>
上边的命令是打包的同时把recovery.tar.xz和boot.tar.xz放在zImage末尾，如何调用,以启动recovery(recovery.sh)为例子：
<pre><code>cd /
eval $(read_boot_headers /dev/block/mmcblk0p5)
load_offset=$recovery_offset
load_len=$recovery_len
dd bs=512 if=/dev/block/mmcblk0p5 skip=$load_offset count=$load_len | xzcat | tar x</pre></code>
自定义zImage压缩格式：
<pre><code>./repack.sh zImagesy267 initramfs.cpio new_zImage gzip
或者
./repack.sh zImagesy267 initramfs.cpio new_zImage payload gzip</pre></code>
cygwin:<br>
<img src=images/screencap_cygwin.png>
ubuntu:<br>
<img src=images/screencap_ubuntu.png>
        </section>

        <footer>
          Galaxys2 kernel repack is maintained by <a href="https://github.com/xiaolu">xiaolu</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>
